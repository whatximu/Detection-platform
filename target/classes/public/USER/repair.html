<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>异响检测平台</title>
  <link rel="icon" href="../../static/demo1/img/013.png" type="image/x-icon">
  <link rel="stylesheet" href="../../static/layui/css/layui.css" media="all"/>
  <!-- import CSS -->
  <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
</head>
<body class="layui-layout-body">
<!--<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.js"></script>-->
<script src="../../js/jquery.min.js"></script>
<script src="../../js/jquery.cookie.js"></script>

<div class="layui-layout layui-layout-admin">
  <div class="layui-header" >
    <ul class="layui-nav" >
      <li class="layui-nav-item">
        <a href="http://101.37.66.239:8081/USER/form.html">问题上传</a></li>
      <li class="layui-nav-item">
        <a href="http://101.37.66.239:8081/USER/list.html">问题查看</a></li>
      <li class="layui-nav-item">
        <a href="http://101.37.66.239:8081/USER/repairTable.html">售后维修</a></li>

    </ul>
    <!-- 头部区域（可配合layui已有的水平导航） -->
    <ul class="layui-nav layui-layout-right">
      <li class="layui-nav-item">
        <a href="javascript:;" id="usernameinfo">

        </a>

        <dl class="layui-nav-child">
          <dd><a href="">基本资料</a></dd>
          <dd><a href="">安全设置</a></dd>
        </dl>
      </li>
      <li class="layui-nav-item"><a href="http://101.37.66.239:8081/">退出</a></li>
    </ul>
  </div>

  <div class="layui-tab layui-tab-brief" lay-filter="demoTitle">
    <div class="layui-body layui-tab-content site-demo site-demo-body">

      <div id="el-form-steps">


        <div class="layui-tab-item layui-show">

          <el-steps :active="active" finish-status="success" simple>
            <el-step title="售后服务详情" ></el-step>
          </el-steps>
          <div class="layui-main">
            <div id="LAY_preview">

              <div style="height: 10px"></div>
              <el-form ref="form" :model="form" label-width="100px" class="layui-form" action="">



                <div v-if="active==0" >
                  <div  style="display:none" >
                    <el-row style="height: 60px">
                      <el-col :span="8" style="height: 40px;width:1020px">
                        <el-form-item label="id" >
                          <el-input v-model="form.xprax" id="usernamea" style="line-height: 40px"></el-input>

                        </el-form-item>
                      </el-col>
                    </el-row>
                  </div>

                  <el-row style="height: 60px">
                    <el-col :span="8" style="height: 40px;width:340px">
                      <el-form-item label="维修日期">
                        <el-date-picker type="date" placeholder="选择日期" value-format="yyyy-MM-dd" v-model="form.reportdate"
                                        style="width:200px;"></el-date-picker>
                      </el-form-item>
                    </el-col>
                  </el-row>

                  <el-row style="height: 60px">
                    <el-col :span="8" style="height: 40px;width:340px">
                      <el-form-item label="更换零件名称">
                        <el-input v-model="form.carbrand" style="width:200px;"/>
                      </el-form-item>
                    </el-col>
                  </el-row>

                  <el-row style="height: 100px">
                    <el-col :span="8" style="width:1020px">
                      <el-form-item label="详细维修内容">
                        <el-input :rows=3 type="textarea" v-model="form.desc"></el-input>
                      </el-form-item>
                    </el-col>
                  </el-row>

                  <el-row style="height: 100px">
                    <el-col :span="8" style="width:1020px">
                      <el-form-item label="其他">
                        <el-input :rows=3 type="textarea" v-model="form.load"></el-input>
                      </el-form-item>
                    </el-col>
                  </el-row>

                  <el-row style="height: 60px">
                    <el-col :span="8" style="height: 40px;width:1020px">


                      <el-form-item label="维修结果">

                        <el-radio-group v-model="form.refit">
                          <el-radio label="已解决"></el-radio>
                          <el-radio label="未解决"></el-radio>
                        </el-radio-group>
                      </el-form-item>
                    </el-col>
                  </el-row>

                </div>
              </el-form>

            </div>
          </div>
          <div class="layui-tab-item">

          </div>

        </div>

        <div>
          <el-button round size="mini" @click="submit" v-if="active===0">提交</el-button>
        </div>
      </div>

    </div>
  </div>

</div>



<script src="../../static/layui/layui.js" charset="utf-8"></script>






<style>
  .el-dropdown-link {
    cursor: pointer;
    color: #eee;
  }

  .el-icon-arrow-down {
    font-size: 12px;
  }

  #LAY_layedit_code {
    text-align: center;
  }

  .layui-tab-item{
    width: 1090px;
    display: none;
  }
  .el-step__title.is-process {
    font-weight: 700;
    color: #409eff;
  }
  .el-step__title.is-wait {
    color: #303133;
  }
  .el-step__head.is-process {
    color: #409eff;
    border-color: #409eff;
  }
  .el-step__head.is-wait{
    color: #303133;
    border-color: #303133;
  }
</style>

</body>
<!-- import Vue before Element -->
<script src="https://unpkg.com/vue/dist/vue.js"></script>
<!--&lt;!&ndash; import JavaScript &ndash;&gt;-->
<script src="https://unpkg.com/element-ui/lib/index.js"></script>

<script>
  var qj;
  function Pusha() {

    $.ajax({
      url:"http://101.37.66.239:8081/result/get",
      data:JSON.stringify(usr),
      type: "POST",
      async: true,
      dataType:"json",
      contentType: "application/json; charset=utf-8",

      success:function(result){
        $.cookie("code_xpra",result.code);
        $.cookie("percent",result.active_percent);



      },



    })



  }

  var searchUrl = window.location.href;
  var searchData = searchUrl.split("="); //截取 url中的“=”,获得“=”后面的参数

  var username=$.cookie('username');
  var usr={"username":username}
  var name=$.cookie('name');
  var str= '<img src="../../static/userimage/0.jpg" class="layui-nav-img" >'+name


  document.getElementById("usernameinfo").innerHTML=str;

  var Main = {
    data() {
      return {
        active: 0,
        form: {
          id:'',
          reportdate: '',
          carbrand: '',
          desc: '',
          load: '',
          refit: '',
          xprax: '',
          abnormalx:'',
        },
      };
    },

    methods: {
      next() {
        if (this.active++ > 1) this.active = 0;
      },

      handleCommand(command) {
        this.$message('click on item ' + command);
        var twoUrl2 = encodeURI(command+".html"); //使用encodeURI编码
        location.href = twoUrl2;
      },
      first() {
        // this.$message('click on item ' + command);
        var twoUrl2 = encodeURI("USER/first.html"); //使用encodeURI编码
        location.href = twoUrl2;
      },
      submit() {
        $("#usernamea").val($.cookie("username"));
        this.form.xprax=$.cookie("username");
        this.form.abnormalx=qj;
        this.form.id=$.cookie("id");
        console.log(this.form.xprax)
        console.log(this.form.abnormalx)
        $.ajax({
          url:"http://101.37.66.239:8081/form/addRepair",
          data:JSON.stringify(this.form),
          type: "POST",
          async: true,
          dataType:"json",
          contentType: "application/json; charset=utf-8",
          beforeSend: function(){

            $("<p class=\"datagrid-mask\"></p>").css({ display: "block", width: "100%", height: $(window).height() }).appendTo("body");
            $("<p class=\"datagrid-mask-msg\"></p>").html("正在提交,请稍候...").appendTo("body").css({ display: "block", left: ($(document.body).outerWidth(true) - 190) / 2, top: ($(window).height() - 45) / 2 });
          },
          complete: function() {
            $(".datagrid-mask").remove();
            $(".datagrid-mask-msg").remove();
          },

          success:function(result){

            alert("提交成功")
            var twoUrl = encodeURI("repairTable.html"); //使用encodeURI编码
            location.href = twoUrl;


          },

        })
      }
    }
  }
  var Ctor = Vue.extend(Main)
  var Ctor2 = Vue.extend(Main)
  new Ctor().$mount('#el-form-steps')
  new Ctor2().$mount('#xpra')

</script>
</html>
